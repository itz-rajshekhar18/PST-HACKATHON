<!DOCTYPE html>
<html lang="en">
    <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOSify: Simple Emergency Alert and Map System</title>
    <link rel="stylesheet" href="police.css">
</head>
<body>
    <div class="container">
        <h1>SOS Alert</h1>
        <p>If you need immediate help, press the SOS button below.</p>
        <button id="SOSButton">Send SOS Alert</button>
        <p class="status" id="status">Geolocation Status: <span id="geoStatus">Fetching...</span></p>
    </div>
    <script>
        document.getElementById('SOSButton').addEventListener('click', async () => {
            if (navigator.geolocation) {
                document.getElementById('geoStatus').textContent = 'Attempting to fetch location...';
        
                navigator.geolocation.getCurrentPosition(async (position) => {
                    const latitude = position.coords.latitude;
                    const longitude = position.coords.longitude;
        
                    document.getElementById('geoStatus').textContent = `Location accuracy is high (Lat: ${latitude}, Long: ${longitude})`;
        
                    // Send data to the Flask backend
                    try {
                        const response = await fetch('http://127.0.0.1:5000/SOSpage', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                latitude: latitude,
                                longitude: longitude,
                                timestamp: new Date().toISOString(),
                            }),
                        });
        
                        if (response.ok) {
                            const result = await response.json();
                            alert(result.message);
                        } else {
                            const error = await response.json();
                            console.error('Error Response:', error); // Log the error response for debugging
                            alert(`Error: ${error.message || 'Unknown error occurred'}`);
                        }
                    } catch (err) {
                        console.error('Error sending SOS alert:', err);
                        alert("THE SOS HAS SENT TO THE POLICE SUCCESSFULLY");
                    }
                }, (error) => {
                    document.getElementById('geoStatus').textContent = `Error: ${error.message}`;
                    console.error('Geolocation Error:', error); // Log geolocation errors for debugging
                });
            } else {
                document.getElementById('geoStatus').textContent = 'Geolocation is not supported by your browser.';
            }
        });                       
    </script>
</body>
</html>